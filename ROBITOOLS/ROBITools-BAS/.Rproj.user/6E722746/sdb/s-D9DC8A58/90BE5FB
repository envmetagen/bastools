{
    "collab_server" : "",
    "contents" : "setwd(\"C:/Users/basti/Documents/WORK/CIBIO/STATS_AND_CODE/OBITOOLS/ecoPCRoutput/USING 16S\")\n\nlibrary(ROBIBarcodes)\nlibrary(ROBITaxonomy)\nlibrary(ROBITools)\nlibrary(ROBIUtils)\n\necopcroutput=read.ecopcr.result(\"FROG33_NT.ecopcroutput\")\n#really need to make sure this file is good before proceeding\n\n#Define Primers THAT YOU USED FOR ECOPCROUTPUT \nFROGFORWARD<-\"GACCCYATGGARCTTWARAC\"\nFROGREVERSE<-\"TARCTTGGTYCGTTGATCA\"\n\ntaxo=read.taxonomy(\"taxdump\")\n\n#make primerlogos. is.subcladeof function keeps crashing R, so this workaround\nget.classic.taxonomy.BAS = function(x, taxo) {\n  \n  classic.taxo = c(\"kingdom\", \"phylum\", \"class\", \"order\", \"family\", \"genus\", \"species\")\n  \n  taxids = x$taxid\n  \n  out = as.data.frame(do.call(\"cbind\", lapply(classic.taxo, function(y) {\n    scientificname(taxo, taxonatrank(taxo,taxids,y))\n  })))\n  \n  colnames(out) = paste(classic.taxo, \"_name_ok\", sep=\"\")\n  rownames(out) = row.names(x)\n  \n  out$scientific_name_ok = scientificname(taxo, taxids)\n  out$taxonomic_rank_ok = taxonomicrank(taxo, taxids)\n  \n  return(out)\n}\n\ntaxon.table=get.classic.taxonomy.BAS(ecopcroutput,taxo)\nis_a_frog=taxon.table$order_name_ok == \"Anura\"\ntable(is_a_frog)\nfrog.forward=ecopcr.forward.shanon(ecopcr = ecopcroutput,group = is_a_frog)\nfrog.reverse=ecopcr.reverse.shanon(ecopcr = ecopcroutput,group = is_a_frog)\npar(mfcol=c(2,2))\ndnalogoplot(frog.forward$'TRUE',primer = FROGFORWARD,main='Forward frog')\ndnalogoplot(frog.forward$'FALSE',primer = FROGFORWARD,main='Forward not frog')\ndnalogoplot(frog.reverse$'TRUE',primer = FROGREVERSE,main='Reverse frog')\ndnalogoplot(frog.reverse$'FALSE',primer = FROGREVERSE,main='Reverse not frog')\n\n##IF THERE ARE ONLY FROG SEQUNECES IN ECOPCROUTPUT, THEN USE:\nfrog.forward=ecopcr.forward.shanon(ecopcroutput)\nfrog.reverse=ecopcr.reverse.shanon(ecopcroutput)\npar(mfcol=c(2,2))\ndnalogoplot(frog.forward, primer = FROGFORWARD, main='Forward frog')\ndnalogoplot(frog.reverse, primer = FROGREVERSE, main='Reverse frog')\n\n#make mismatch plot\npar(mfcol=c(1,1))\nmismatchplot(ecopcroutput,group = is_a_frog,legend=c('Not a frog','frog'))\n\n#make bargraphs of ecoPCR hits for various taxonomic levels\nspecies.frame<-as.data.frame(ecopcroutput$taxid)\nspecies.frame$species=species.frame$\"ecopcroutput$taxid\"\nspecies.frame$\"ecopcroutput$taxid\"=NULL\n\n#####RESTART FROM HERE FOR VARIOUS PRIMER MISMATCHES####\ntaxonatrank.kingdom<-taxonatrank(taxo, species.frame$species,\"kingdom\",TRUE)\nspecies.frame$kingdom=taxonatrank.kingdom\ntaxonatrank.phylum<-taxonatrank(taxo,species.frame$species,\"phylum\",TRUE)\nspecies.frame$phylum=taxonatrank.phylum\ntaxonatrank.class<-taxonatrank(taxo,species.frame$species,\"class\",TRUE)\nspecies.frame$class=taxonatrank.class\ntaxonatrank.order<-taxonatrank(taxo,species.frame$species,\"order\",TRUE)\nspecies.frame$order=taxonatrank.order\ntaxonatrank.family<-taxonatrank(taxo,species.frame$species,\"family\",TRUE)\nspecies.frame$family=taxonatrank.family\ntaxonatrank.genus<-taxonatrank(taxo,species.frame$species,\"genus\",TRUE)\nspecies.frame$genus=taxonatrank.genus\ntaxonatrank.species<-taxonatrank(taxo,species.frame$species,\"species\",TRUE)\nspecies.frame$species=taxonatrank.species\n\n#mar=c(bottom, left, top, right)\npar(mar = c(10,5,4,2) + 0.1)\npar(bg=\"transparent\")\nbarplot(table(species.frame$kingdom),las=2)\nmtext(\"No. of ecoPCR hits (sequences) in nt database\", side=2, line=3.8, cex = 1.3)\nbarplot(table(species.frame$phylum),las=2)\nmtext(\"No. of ecoPCR hits (sequences) in nt database\", side=2, line=3.8, cex = 1.3)\nbarplot(table(species.frame$class),las=2)\nmtext(\"No. of ecoPCR hits (sequences) in nt database\", side=2, line=3.8, cex = 1.3)\nbarplot(table(species.frame$order),las=2)\nmtext(\"No. of ecoPCR hits (sequences) in nt database\", side=2, line=3.8, cex = 1.3)\nbarplot(table(species.frame$family),las=2)\nmtext(\"No. of ecoPCR hits (sequences) in nt database\", side=2, line=3.8, cex = 1.3)\n\n#to do this for various primer mismatches, use below and repeat graph building above each time\nPrimerMismatch<-subset(ecopcroutput,ecopcroutput$forward_mismatch<=1)\nPrimerMismatch<-subset(PrimerMismatch,PrimerMismatch$reverse_mismatch<=1)\nspecies.frame<-as.data.frame(PrimerMismatch$taxid)\nspecies.frame$species=species.frame$\"PrimerMismatch$taxid\"\nspecies.frame$\"PrimerMismatch$taxid\"=NULL\n\n#taxonomic resolution\nonly.frog=ecopcroutput[is_a_frog,]\nresAnura = resolution(taxo,only.frog)\nresolutionAnura = with(only.frog,unique(data.frame(species_name,taxid,rank=resAnura)))\nresAnuraTable<-t(t(sort(table(resolutionAnura$rank)/length(resolutionAnura$rank),decreasing = TRUE)))\nresAnuraTable\n\n#To explore hits by species etc. \nspecies.frame$taxid<-species.frame$species\ntaxon.table=get.classic.taxonomy.BAS(species.frame,taxo)\n",
    "created" : 1517922772197.000,
    "dirty" : true,
    "encoding" : "ISO-8859-1",
    "folds" : "",
    "hash" : "2501685653",
    "id" : "90BE5FB",
    "lastKnownWriteTime" : 1505828709,
    "last_content_update" : 1517929089720,
    "path" : "~/WORK/CIBIO/SCRIPTS/ROBITools scripts/SIMPLIFIED ECOPCR SCRIPT FOR ASSESSING SPECIFICITY EG AGAINST NT.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}